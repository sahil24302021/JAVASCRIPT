{"version":3,"file":"utils.js","names":["fields: { tavilyApiKey?: string; apiBaseUrl?: string }","params: Record<string, unknown>","result: Record<string, unknown>","params: TavilySearchParams","params: TavilyExtractParams","params: TavilyCrawlParams","params: TavilyMapParams","params: TavilyResearchParams","requestId: string"],"sources":["../src/utils.ts"],"sourcesContent":["import { getEnvironmentVariable } from \"@langchain/core/utils/env\";\n\nconst TAVILY_BASE_URL = \"https://api.tavily.com\";\n\n/**\n * The parameters for the Tavily Search API.\n */\nexport type TavilySearchParamsBase = {\n  /**\n   * The query to search for.\n   */\n  query: string;\n  /**\n   * The topic of the search.\n   *\n   * @default \"general\"\n   */\n  topic?: \"general\" | \"news\" | \"finance\";\n  /**\n   * The depth of the search.\n   *\n   * @default \"basic\"\n   */\n  search_depth?: \"basic\" | \"advanced\";\n\n  /**\n   * The number of {@link TavilySearchResult.content} chunks to retrieve from each source.\n   * Each chunk's length is maximum 500 characters. Available only when\n   * {@link TavilySearchParams.search_depth} is advanced.\n   *\n   * @default 3\n   */\n  chunks_per_source?: number;\n  /**\n   * The maximum number of search results to return.\n   *\n   * @default 5\n   */\n  max_results?: number;\n  /**\n   * The time range of the search.\n   */\n  time_range?: \"day\" | \"week\" | \"month\" | \"year\";\n  /**\n   * Number of days back from the current date to include. Available only if topic is news.\n   */\n  days?: number;\n  /**\n   * Include an LLM-generated answer to the provided query. `\"basic\"` or `true` returns a quick\n   * answer, while `\"advanced\"` returns a more detailed answer.\n   *\n   * @default false\n   */\n  include_answer?: boolean | \"basic\" | \"advanced\";\n  /**\n   * Include the cleaned and parsed HTML content of each search result.\n   * \"markdown\" returns search result content in markdown format.\n   * \"text\" returns the plain text from the results and may increase latency.\n   * If true, defaults to \"markdown\"\n   *\n   * @default false\n   */\n  include_raw_content?: boolean | \"markdown\" | \"text\";\n  /**\n   * A list of domains to specifically include in the search results.\n   */\n  include_domains?: string[];\n  /**\n   * A list of domains to specifically exclude from the search results.\n   */\n  exclude_domains?: string[];\n\n  /**\n   * Whether to include the favicon URL for each result.\n   *\n   * @default false\n   */\n  include_favicon?: boolean;\n  /**\n   * Whether to include usage information (credits) in the response.\n   *\n   * @default false\n   */\n  include_usage?: boolean;\n} & Record<string, unknown>;\n\nexport type TavilySearchParamsWithSimpleImages = TavilySearchParamsBase & {\n  /**\n   * Also perform an image search and include the results in the response.\n   *\n   * @default false\n   */\n  include_images?: boolean;\n  /**\n   * When {@link TavilySearchParams.include_images} is true, also add a descriptive text for each\n   * image.\n   *\n   * @default false\n   */\n  include_image_descriptions?: false;\n};\n\nexport type TavilySearchParamsWithImageDescriptions = TavilySearchParamsBase & {\n  /**\n   * Also perform an image search and include the results in the response.\n   */\n  include_images?: true;\n  /**\n   * When {@link TavilySearchParams.include_images} is true, also add a descriptive text for each\n   * image.\n   */\n  include_image_descriptions?: true;\n};\n\nexport type TavilySearchParams =\n  | TavilySearchParamsWithSimpleImages\n  | TavilySearchParamsWithImageDescriptions;\n\n/**\n * The parameters for the Tavily Extract API.\n */\nexport type TavilyExtractParams = {\n  /**\n   * The URL or list of URLs to extract content from.\n   *\n   * Example: \"https://en.wikipedia.org/wiki/Artificial_intelligence\" or\n   * [\"https://en.wikipedia.org/wiki/Artificial_intelligence\", ...]\n   */\n  urls: string | string[];\n  /**\n   * Include a list of images extracted from the URLs in the response.\n   *\n   * @default false\n   */\n  include_images?: boolean;\n  /**\n   * The depth of the extraction process. `\"advanced\"` extraction retrieves more data, including\n   * tables and embedded content, with higher success but may increase latency. The cost for\n   * `\"advanced\"` extraction requests may be higher than `\"basic\"` extraction.\n   *\n   * @default \"basic\"\n   */\n  extract_depth?: \"basic\" | \"advanced\";\n\n  /**\n   * Whether to include the favicon URL for each result.\n   *\n   * @default false\n   */\n  include_favicon?: boolean;\n\n  /**\n   * The format of the extracted web page content.\n   * \"markdown\" returns content in markdown format.\n   * \"text\" returns plain text and may increase latency.\n   *\n   * @default \"markdown\"\n   */\n  format?: \"markdown\" | \"text\";\n\n  /**\n   * Whether to include usage information (credits) in the response.\n   *\n   * @default false\n   */\n  includeUsage?: boolean;\n\n  /**\n   * User intent query for reranking extracted content chunks.\n   */\n  query?: string;\n} & Record<string, unknown>;\n\n/**\n * The parameters for the Tavily Search API.\n */\nexport type ExtractDepth = \"basic\" | \"advanced\";\nexport type CrawlCategory =\n  | \"Documentation\"\n  | \"Blog\"\n  | \"Blogs\"\n  | \"Community\"\n  | \"About\"\n  | \"Contact\"\n  | \"Privacy\"\n  | \"Terms\"\n  | \"Status\"\n  | \"Pricing\"\n  | \"Enterprise\"\n  | \"Careers\"\n  | \"E-Commerce\"\n  | \"Authentication\"\n  | \"Developer\"\n  | \"Developers\"\n  | \"Solutions\"\n  | \"Partners\"\n  | \"Downloads\"\n  | \"Media\"\n  | \"Events\"\n  | \"People\";\nexport type TavilyCrawlParams = {\n  /**\n   * The URL to start crawling from.\n   *\n   * Example: \"https://example.com\"\n   */\n  url: string;\n\n  /**\n   * Natural language instructions to guide the crawler\n   *\n   * @default undefined\n   */\n  instructions?: string;\n\n  /**\n   * The depth of the extractions. It can be \"basic\" or \"advanced\".\n   *\n   */\n  extractDepth?: ExtractDepth;\n\n  /**\n   * The format of the respose. It can be \"markdown\" or \"text\"\n   *\n   * @default \"markdown\"\n   */\n  format?: \"markdown\" | \"text\";\n\n  /**\n   * The maximum number of hops from the starting URL.\n   *\n   * @default 3\n   */\n  maxDepth?: number;\n\n  /**\n   * The maximum number of pages to crawl per level.\n   *\n   * @default 50\n   */\n  maxBreadth?: number;\n\n  /**\n   * The maximum number of pages to crawl.\n   *\n   * @default 100\n   */\n  limit?: number;\n\n  /**\n   * Only crawl URLs containing these categories.\n   *\n   * @default undefined\n   */\n  categories?: CrawlCategory[];\n\n  /**\n   * Only crawl URLs containing these paths.\n   *\n   * @default undefined\n   */\n  selectPaths?: string[];\n\n  /**\n   * Only crawl these domains.\n   *\n   * @default undefined\n   */\n  selectDomains?: string[];\n\n  /**\n   * Exclude these paths.\n   *\n   * @default undefined\n   */\n  excludePaths?: string[];\n\n  /**\n   * Exclude these domains.\n   *\n   * @default undefined\n   */\n  excludeDomains?: string[];\n\n  /**\n   * Allow crawling external domains.\n   *\n   * @default undefined\n   */\n  allowExternal?: boolean;\n\n  /**\n   * Include images in the crawl results.\n   *\n   * @default false\n   */\n  includeImages?: boolean;\n\n  /**\n   * Whether to include the favicon URL for each result.\n   *\n   * @default false\n   */\n  include_favicon?: boolean;\n\n  /**\n   * Whether to include usage information (credits) in the response.\n   *\n   * @default false\n   */\n  includeUsage?: boolean;\n\n  /**\n   * The number of content chunks to retrieve from each source.\n   *\n   * @default 3\n   */\n  chunksPerSource?: number;\n} & Record<string, unknown>;\n\n/**\n * A single extraction result from the Tavily Extract API.\n */\nexport type TavilyExtractResult = {\n  /**\n   * The URL from which the content was extracted.\n   */\n  url: string;\n  /**\n   * The full content extracted from the page.\n   */\n  raw_content: string;\n  /**\n   * This is only available if {@link TavilyExtractParams.include_images} is set to `true`. A list\n   * of image URLs extracted from the page.\n   */\n  images: string[];\n} & Record<string, unknown>;\n\n/**\n * A failed extraction result from the Tavily Extract API.\n */\nexport type TavilyFailedResult = {\n  /**\n   * The URL that failed to be processed.\n   */\n  url: string;\n  /**\n   * An error message describing why the URL couldn't be processed.\n   */\n  error: string;\n} & Record<string, unknown>;\n\n/**\n * The response from the Tavily Extract API.\n */\nexport type TavilyExtractResponse = {\n  /**\n   * A list of extracted content from the provided URLs.\n   */\n  results: TavilyExtractResult[];\n  /**\n   * A list of URLs that could not be processed.\n   */\n  failed_results: TavilyFailedResult[];\n  /**\n   * Time in seconds it took to complete the request.\n   */\n  response_time: number;\n} & Record<string, unknown>;\n\n/**\n * A single search result from the Tavily Search API.\n */\nexport type TavilySearchResult = {\n  /**\n   * The title of the search result.\n   */\n  title: string;\n  /**\n   * The URL of the search result.\n   */\n  url: string;\n  /**\n   * A short description of the search result.\n   */\n  content: string;\n  /**\n   * The relevance score of the search result.\n   */\n  score: number;\n  /**\n   * The cleaned and parsed HTML content of the search result. Only if\n   * {@link TavilySearchParams.includeRawContent} is true.\n   */\n  raw_content: string | null;\n} & Record<string, unknown>;\n\n/**\n * The base response from the Tavily Search API.\n */\nexport type TavilyBaseSearchResponse = {\n  /**\n   * The search query that was executed.\n   */\n  query: string;\n  /**\n   * A short answer to the user's query, generated by an LLM. Included in the response only if\n   * {@link TavilySearchParams.include_answer} is requested (i.e., set to `true`, `\"basic\"`, or\n   * `\"advanced\"`).\n   */\n  answer?: string;\n  /**\n   * The results from the search.\n   */\n  auto_parameters?: Partial<TavilySearchParams>;\n  results: TavilySearchResult[];\n  /**\n   * The response time of the search.\n   */\n  response_time: number;\n} & Record<string, unknown>;\n\n/**\n * The shape of the response from the Tavily Search API when\n * {@link TavilySearchParams.include_image_descriptions} is true.\n */\nexport type TavilySearchResponseWithImageDescriptions =\n  TavilyBaseSearchResponse & {\n    /**\n     * List of query-related images. If {@link TavilySearchParams.include_image_descriptions} is\n     * `true`, each item will be an object with `url` and `description` properties. Otherwise, each\n     * item will be a string containing the URL of the image.\n     */\n    images?: {\n      /**\n       * The URL of the image.\n       */\n      url: string;\n      /**\n       * The description of the image.\n       */\n      description?: string;\n    }[];\n  };\n\n/**\n * The shape of the response from the Tavily Search API when\n * {@link TavilySearchParams.include_image_descriptions} is `false` or unspecified.\n */\nexport type TavilySearchResponseWithSimpleImages = TavilyBaseSearchResponse & {\n  /**\n   * List of query-related images. If {@link TavilySearchParams.include_image_descriptions} is\n   * `true`, each item will be an object with `url` and `description` properties. Otherwise, each\n   * item will be a string containing the URL of the image.\n   */\n  images?: string[];\n};\n\nexport type TavilyCrawlResponse = {\n  /**\n   * The base URL that was crawled.\n   */\n  base_url: string;\n  /**\n   * The results of the crawl.\n   */\n  results: TavilyExtractResult[];\n  /**\n   * The response time of the crawl.\n   */\n  response_time: number;\n} & Record<string, unknown>;\n\n/**\n * The parameters for the Tavily Map API.\n */\nexport type TavilyMapParams = {\n  /**\n   * The URL to start mapping from.\n   *\n   * Example: \"https://example.com\"\n   */\n  url: string;\n\n  /**\n   * Natural language instructions to guide the crawler\n   *\n   * @default undefined\n   */\n  instructions?: string;\n\n  /**\n   * The maximum number of hops from the starting URL.\n   *\n   * @default 3\n   */\n  maxDepth?: number;\n\n  /**\n   * The maximum number of pages to crawl per level.\n   *\n   * @default 50\n   */\n  maxBreadth?: number;\n\n  /**\n   * The maximum number of pages to crawl.\n   *\n   * @default 100\n   */\n  limit?: number;\n\n  /**\n   * Only crawl URLs containing these categories.\n   *\n   * @default undefined\n   */\n  categories?: CrawlCategory[];\n\n  /**\n   * Only crawl URLs containing these paths.\n   *\n   * @default undefined\n   */\n  selectPaths?: string[];\n\n  /**\n   * Only crawl these domains.\n   *\n   * @default undefined\n   */\n  selectDomains?: string[];\n\n  /**\n   * Exclude these paths.\n   *\n   * @default undefined\n   */\n  excludePaths?: string[];\n\n  /**\n   * Exclude these domains.\n   *\n   * @default undefined\n   */\n  excludeDomains?: string[];\n\n  /**\n   * Allow crawling external domains.\n   *\n   * @default undefined\n   */\n  allowExternal?: boolean;\n\n  /**\n   * Whether to include usage information (credits) in the response.\n   *\n   * @default false\n   */\n  includeUsage?: boolean;\n} & Record<string, unknown>;\n\nexport type TavilyMapResponse = {\n  /**\n   * The base URL that was mapped.\n   */\n  base_url: string;\n  /**\n   * The results of the map operation - array of URL strings.\n   */\n  results: string[];\n  /**\n   * The response time of the map operation.\n   */\n  response_time: number;\n} & Record<string, unknown>;\n\nexport type TavilySearchResponse =\n  | TavilySearchResponseWithImageDescriptions\n  | TavilySearchResponseWithSimpleImages;\n\n/**\n * The parameters for the Tavily Research API.\n */\nexport type TavilyResearchParams = {\n  /**\n   * The research task or question to investigate.\n   */\n  input: string;\n  /**\n   * The research model to use. `mini` provides a quick overview,\n   * `pro` conducts comprehensive research with multiple searches, and `auto`\n   * automatically determines the appropriate model based on the task.\n   *\n   * @default \"auto\"\n   */\n  model?: \"mini\" | \"pro\" | \"auto\";\n  /**\n   * A JSON Schema object that defines the structure of the research output.\n   * When provided, the response will be structured according to this schema.\n   */\n  outputSchema?: Record<string, unknown>;\n  /**\n   * Whether to stream the research results as they are generated.\n   * When `true`, returns a Server-Sent Events (SSE) stream.\n   *\n   * @default false\n   */\n  stream?: boolean;\n  /**\n   * Citation style for the research results.\n   *\n   * @default \"numbered\"\n   */\n  citationFormat?: \"numbered\" | \"mla\" | \"apa\" | \"chicago\";\n};\n\n/**\n * The queued response from creating a research task (POST /research).\n */\nexport type TavilyResearchQueueResponse = {\n  /**\n   * Unique identifier for the research request.\n   */\n  request_id: string;\n  /**\n   * Timestamp when the research request was created.\n   */\n  created_at: string;\n  /**\n   * Status of the research request (initially \"pending\").\n   */\n  status: \"pending\" | \"in_progress\";\n  /**\n   * The research task input.\n   */\n  input: string;\n  /**\n   * The research model used.\n   */\n  model: string;\n  /**\n   * Response time for the queue operation.\n   */\n  response_time?: number;\n} & Record<string, unknown>;\n\n/**\n * The response from the Tavily Research API (GET /research/{request_id}).\n */\nexport type TavilyGetResearchResponse = {\n  /**\n   * Unique identifier for the research request.\n   */\n  request_id: string;\n  /**\n   * Timestamp when the research request was created.\n   */\n  created_at: string;\n  /**\n   * Timestamp when the research was completed.\n   */\n  completed_at: string;\n  /**\n   * Status of the research request.\n   */\n  status: \"completed\" | \"pending\" | \"in_progress\" | \"failed\";\n  /**\n   * The research content. Can be a string (for text responses) or a dict (for structured output).\n   */\n  content: string | Record<string, unknown>;\n  /**\n   * List of sources used in the research.\n   */\n  sources: Array<Record<string, unknown>>;\n\n  /**\n   * The response time of the research request.\n   */\n  response_time: number;\n} & Record<string, unknown>;\n\nexport type TavilyGetIncompleteResearchResponse = Pick<\n  TavilyGetResearchResponse,\n  \"request_id\" | \"status\" | \"response_time\"\n>;\n\n/**\n * Base wrapper class with shared functionality for Tavily API wrappers.\n */\nabstract class BaseTavilyAPIWrapper {\n  tavilyApiKey?: string;\n\n  apiBaseUrl?: string;\n\n  /**\n   * Constructs a new instance of the BaseTavilyAPIWrapper.\n   * @param fields The fields used to initialize the wrapper.\n   */\n  constructor(fields: { tavilyApiKey?: string; apiBaseUrl?: string }) {\n    const apiKey =\n      fields.tavilyApiKey ?? getEnvironmentVariable(\"TAVILY_API_KEY\");\n    if (!apiKey) {\n      throw new Error(\n        \"Tavily API key not found. Please provide it as an argument or set the TAVILY_API_KEY environment variable.\"\n      );\n    }\n    this.tavilyApiKey = apiKey;\n    this.apiBaseUrl = fields.apiBaseUrl ?? TAVILY_BASE_URL;\n  }\n\n  /**\n   * Converts camelCase keys to snake_case for API compatibility\n   * @param params The parameters with camelCase keys\n   * @returns The parameters with snake_case keys only\n   */\n  protected convertCamelToSnakeCase(\n    params: Record<string, unknown>\n  ): Record<string, unknown> {\n    const result: Record<string, unknown> = {};\n\n    for (const [key, value] of Object.entries(params)) {\n      if (value === undefined) {\n        continue;\n      }\n      // Convert camelCase key to snake_case\n      // Handle potential leading capital letter first\n      let newKey = key.replace(/^[A-Z]/, (letter) => letter.toLowerCase());\n      // Then handle subsequent capital letters\n      newKey = newKey.replace(/[A-Z]/g, (letter) => `_${letter.toLowerCase()}`);\n\n      result[newKey] = value;\n    }\n\n    return result;\n  }\n}\n\n/**\n * A wrapper that encapsulates access to the Tavily Search API. Primarily used for testing.\n */\nexport class TavilySearchAPIWrapper extends BaseTavilyAPIWrapper {\n  /**\n   * Performs a search using the Tavily Search API.\n   * @param params The parameters for the search.\n   * @returns The raw response body from the Tavily Search API.\n   */\n  async rawResults(\n    params: TavilySearchParamsWithSimpleImages\n  ): Promise<TavilySearchResponseWithSimpleImages>;\n\n  async rawResults(\n    params: TavilySearchParamsWithImageDescriptions\n  ): Promise<TavilySearchResponseWithImageDescriptions>;\n\n  async rawResults(params: TavilySearchParams): Promise<TavilySearchResponse> {\n    const headers = {\n      Authorization: `Bearer ${this.tavilyApiKey}`,\n      \"Content-Type\": \"application/json\",\n    };\n\n    // Convert camelCase to snake_case for API compatibility\n    const apiParams = this.convertCamelToSnakeCase(params);\n\n    const response = await fetch(`${this.apiBaseUrl}/search`, {\n      method: \"POST\",\n      headers,\n      body: JSON.stringify({ ...apiParams, client_source: \"langchain-js\" }),\n    });\n\n    if (!response.ok) {\n      console.log(response);\n      const errorData = await response.json();\n      const errorMessage = errorData.detail?.error || \"Unknown error\";\n      throw new Error(`Error ${response.status}: ${errorMessage}`);\n    }\n\n    return response.json();\n  }\n}\n\n/**\n * A wrapper that encapsulates access to the Tavily Extract API. Primarily used for testing.\n */\nexport class TavilyExtractAPIWrapper extends BaseTavilyAPIWrapper {\n  /**\n   * Extracts content from one or more URLs using the Tavily Extract API.\n   * @param params The parameters for the extraction. See {@link TavilyExtractParams}.\n   * @returns The raw response body from the Tavily Extract API. See {@link TavilyExtractResponse}.\n   */\n  async rawResults(\n    params: TavilyExtractParams\n  ): Promise<TavilyExtractResponse> {\n    const headers = {\n      Authorization: `Bearer ${this.tavilyApiKey}`,\n      \"Content-Type\": \"application/json\",\n    };\n\n    const apiParams = this.convertCamelToSnakeCase(params);\n\n    const response = await fetch(`${this.apiBaseUrl}/extract`, {\n      method: \"POST\",\n      headers,\n      body: JSON.stringify({ ...apiParams, client_source: \"langchain-js\" }),\n    });\n\n    if (!response.ok) {\n      const errorData = await response.json();\n      const errorMessage = errorData.detail?.error || \"Unknown error\";\n      throw new Error(`Error ${response.status}: ${errorMessage}`);\n    }\n\n    return response.json();\n  }\n}\n\n/**\n * A wrapper that encapsulates access to the Tavily Crawl API. Primarily used for testing.\n */\nexport class TavilyCrawlAPIWrapper extends BaseTavilyAPIWrapper {\n  /**\n   * Crawls a list of URLs using the Tavily Crawl API.\n   * @param params The parameters for the crawl. See {@link TavilyCrawlParams}.\n   * @returns The raw response body from the Tavily Crawl API. See {@link TavilyCrawlResponse}.\n   */\n  async rawResults(params: TavilyCrawlParams): Promise<TavilyCrawlResponse> {\n    const headers = {\n      Authorization: `Bearer ${this.tavilyApiKey}`,\n      \"Content-Type\": \"application/json\",\n    };\n\n    const apiParams = this.convertCamelToSnakeCase(params);\n\n    const response = await fetch(`${this.apiBaseUrl}/crawl`, {\n      method: \"POST\",\n      headers,\n      body: JSON.stringify({ ...apiParams, client_source: \"langchain-js\" }),\n    });\n\n    if (!response.ok) {\n      const errorData = await response.json();\n      const errorMessage = errorData.detail?.error || \"Unknown error\";\n      throw new Error(`Error ${response.status}: ${errorMessage}`);\n    }\n\n    return response.json();\n  }\n}\n\n/**\n * A wrapper that encapsulates access to the Tavily Map API. Primarily used for testing.\n */\nexport class TavilyMapAPIWrapper extends BaseTavilyAPIWrapper {\n  /**\n   * Maps a URL using the Tavily Map API.\n   * @param params The parameters for the map. See {@link TavilyMapParams}.\n   * @returns The raw response body from the Tavily Map API. See {@link TavilyMapResponse}.\n   */\n  async rawResults(params: TavilyMapParams): Promise<TavilyMapResponse> {\n    const headers = {\n      Authorization: `Bearer ${this.tavilyApiKey}`,\n      \"Content-Type\": \"application/json\",\n    };\n\n    const apiParams = this.convertCamelToSnakeCase(params);\n\n    const response = await fetch(`${this.apiBaseUrl}/map`, {\n      method: \"POST\",\n      headers,\n      body: JSON.stringify({ ...apiParams, client_source: \"langchain-js\" }),\n    });\n\n    if (!response.ok) {\n      const errorData = await response.json();\n      const errorMessage = errorData.detail?.error || \"Unknown error\";\n      throw new Error(`Error ${response.status}: ${errorMessage}`);\n    }\n\n    return response.json();\n  }\n}\n\n/**\n * A wrapper that encapsulates access to the Tavily Research API. Primarily used for testing.\n */\nexport class TavilyResearchAPIWrapper extends BaseTavilyAPIWrapper {\n  /**\n   * Creates a research task using the Tavily Research API.\n   * @param params The parameters for the research.\n   * @returns The queued response with request_id, or an async generator if streaming.\n   */\n  async rawResults(\n    params: TavilyResearchParams\n  ): Promise<\n    TavilyResearchQueueResponse | AsyncGenerator<Buffer, void, unknown>\n  > {\n    const headers = {\n      Authorization: `Bearer ${this.tavilyApiKey}`,\n      \"Content-Type\": \"application/json\",\n    };\n\n    const apiParams = this.convertCamelToSnakeCase(params);\n\n    if (params.stream) {\n      const response = await fetch(`${this.apiBaseUrl}/research`, {\n        method: \"POST\",\n        headers,\n        body: JSON.stringify({ ...apiParams, client_source: \"langchain-js\" }),\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        const errorMessage = errorData.detail?.error || \"Unknown error\";\n        throw new Error(`Error ${response.status}: ${errorMessage}`);\n      }\n\n      // Return async generator for streaming\n      async function* streamGenerator(): AsyncGenerator<Buffer, void, unknown> {\n        if (!response.body) {\n          throw new Error(\"Response body is null\");\n        }\n\n        const reader = response.body.getReader();\n        try {\n          while (true) {\n            const { done, value } = await reader.read();\n            if (done) {\n              break;\n            }\n            if (value) {\n              yield Buffer.from(value);\n            }\n          }\n        } finally {\n          reader.releaseLock();\n        }\n      }\n\n      return streamGenerator();\n    } else {\n      const response = await fetch(`${this.apiBaseUrl}/research`, {\n        method: \"POST\",\n        headers,\n        body: JSON.stringify({ ...apiParams, client_source: \"langchain-js\" }),\n      });\n      if (!response.ok) {\n        const errorData = await response.json();\n        const errorMessage = errorData.detail?.error || \"Unknown error\";\n        throw new Error(`Error ${response.status}: ${errorMessage}`);\n      }\n\n      return response.json();\n    }\n  }\n\n  /**\n   * Gets research results by request_id.\n   * @param requestId The request ID from the queued research task.\n   * @returns The research results.\n   */\n  async getResearch(requestId: string): Promise<TavilyGetResearchResponse> {\n    const headers = {\n      Authorization: `Bearer ${this.tavilyApiKey}`,\n      \"Content-Type\": \"application/json\",\n    };\n\n    const response = await fetch(`${this.apiBaseUrl}/research/${requestId}`, {\n      method: \"GET\",\n      headers,\n    });\n\n    if (!response.ok) {\n      const errorData = await response.json();\n      const errorMessage = errorData.detail?.error || \"Unknown error\";\n      throw new Error(`Error ${response.status}: ${errorMessage}`);\n    }\n\n    return response.json();\n  }\n}\n"],"mappings":"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"}