{"version":3,"file":"tavily-research.js","names":["outputSchemaPropertySchema: z.ZodTypeAny","params: TavilyResearchAPIRetrieverFields","apiWrapperParams: { tavilyApiKey?: string; apiBaseUrl?: string }","input: InferInteropZodOutput<typeof inputSchema>","_runManager?: CallbackManagerForToolRun","e: unknown"],"sources":["../src/tavily-research.ts"],"sourcesContent":["import { CallbackManagerForToolRun } from \"@langchain/core/callbacks/manager\";\nimport { StructuredTool, ToolParams } from \"@langchain/core/tools\";\nimport { z } from \"zod/v3\";\nimport { InferInteropZodOutput } from \"@langchain/core/dist/utils/types/zod.js\";\nimport {\n  TavilyResearchAPIWrapper,\n  type TavilyResearchQueueResponse,\n} from \"./utils.js\";\n\nexport type ResearchModel = \"mini\" | \"pro\" | \"auto\";\nexport type CitationFormat = \"numbered\" | \"mla\" | \"apa\" | \"chicago\";\n\nexport type TavilyResearchAPIRetrieverFields = ToolParams & {\n  /**\n   * The base URL to be used for the Tavily Research API.\n   */\n  apiBaseUrl?: string;\n\n  /**\n   * The API key used for authentication with the Tavily Research API.\n   */\n  tavilyApiKey?: string;\n\n  /**\n   * The model used by the research agent.\n   *\n   * @default \"auto\"\n   */\n  model?: ResearchModel;\n\n  /**\n   * A JSON Schema object that defines the structure of the research output. \n   * When provided, the research response will be structured to match this schema, ensuring a predictable and validated output shape. \n   * Must include a 'properties' field, and may optionally include 'required' field.\n   * \n   * Example:\n   * \n   * ```json\n   * {\n      \"properties\": {\n        \"company\": {\n          \"type\": \"string\",\n          \"description\": \"The name of the company\"\n        },\n        \"key_metrics\": {\n          \"type\": \"array\",\n          \"description\": \"List of key performance metrics\",\n          \"items\": { \"type\": \"string\" }\n        },\n        \"financial_details\": {\n          \"type\": \"object\",\n          \"description\": \"Detailed financial breakdown\",\n          \"properties\": {\n            \"operating_income\": {\n              \"type\": \"number\",\n              \"description\": \"Operating income for the period\"\n            }\n          }\n        }\n      },\n      \"required\": [\"company\"]\n    }\n   * ```json\n   */\n  outputSchema?: Record<string, unknown>;\n\n  /**\n   * Whether to stream the research results as they are generated.\n   * When 'true', returns a Server-Sent Events (SSE) stream\n   *\n   * @default false\n   */\n  stream?: boolean;\n\n  /**\n   * The format for citations in the research report.\n   *\n   * @default \"numbered\"\n   */\n  citationFormat?: CitationFormat;\n\n  /**\n   * The name of the tool.\n   *\n   * @default \"tavily_research\"\n   */\n  name?: string;\n\n  /**\n   * The description of the tool.\n   *\n   * @default \"Performs comprehensive research on a given topic using the Tavily Research API. Useful for when you need to answer complex questions or gather in-depth information about a subject. Input should be a research task or question.\"\n   */\n  description?: string;\n\n  /**\n   * Whether to return the tool's output directly.\n   *\n   * Setting this to true means that after the tool is called,\n   * an agent should stop looping.\n   *\n   * @default false\n   */\n  returnDirect?: boolean;\n\n  /**\n   * An API wrapper that can be used to interact with the Tavily Research API. Useful for testing.\n   *\n   * If specified, the tool will use this API wrapper instead of creating a new one, and fields used\n   * in API Wrapper initialization, like {@link TavilyResearchAPIRetrieverFields.tavilyApiKey}, will be\n   * ignored.\n   */\n  apiWrapper?: TavilyResearchAPIWrapper;\n};\n\nconst outputSchemaPropertySchema: z.ZodTypeAny = z.lazy(() =>\n  z.object({\n    type: z.enum([\"object\", \"string\", \"integer\", \"number\", \"array\"]).optional(),\n    description: z.string().optional(),\n    properties: z\n      .record(\n        // Recursive definition: nested properties use the same schema shape\n        outputSchemaPropertySchema\n      )\n      .optional(),\n    items: z\n      .object({\n        type: z.enum([\"object\", \"string\", \"integer\", \"number\", \"array\"]),\n      })\n      .optional(),\n  })\n);\n\nconst inputSchema = z.object({\n  input: z.string().describe(\"The research task or question to investigate.\"),\n  model: z\n    .enum([\"mini\", \"pro\", \"auto\"])\n    .optional()\n    .describe(\n      `The model used by the research agent. \n      \"mini\" is optimized for targeted, efficient research and works best for narrow or well-scoped questions. \n      \"pro\" provides comprehensive, multi-angle research and is suited for complex topics that span multiple subtopics or domains.\n      \"auto\" lets Tavily automatically determine the appropriate model based on the task complexity.\n      Default is \"auto\".\n      `\n    ),\n  outputSchema: z\n    .object({\n      properties: z.record(outputSchemaPropertySchema),\n      required: z.array(z.string()).optional(),\n    })\n    .optional()\n    .describe(\n      `\n      A JSON Schema object that defines the structure of the research output. \n      When provided, the research response will be structured to match this schema, ensuring a predictable and validated output shape. \n      Must include a 'properties' field, and may optionally include 'required' field.\n      `\n    ),\n  stream: z\n    .boolean()\n    .optional()\n    .describe(\n      `Whether to stream the research results as they are generated. \n      When 'true', returns a Server-Sent Events (SSE) stream.\n      Default is false.\n      `\n    ),\n  citationFormat: z\n    .enum([\"numbered\", \"mla\", \"apa\", \"chicago\"])\n    .optional()\n    .describe(\n      `The format for citations in the research report.\n      Default is \"numbered\".`\n    ),\n});\n/**\n * A Tool for performing comprehensive research with the Tavily Research API.\n * Extends the StructuredTool class and provides an intelligent research agent\n * that can answer complex questions and gather in-depth information.\n *\n * Authentication is handled via an API key, which can be passed during\n * instantiation or set as an environment variable `TAVILY_API_KEY`.\n *\n * Example:\n * ```typescript\n * const tool = new TavilyResearch({\n *   model: \"pro\",\n *   citationFormat: \"apa\",\n *   tavilyApiKey: \"YOUR_API_KEY\"\n * });\n * const results = await tool.invoke({\n *   input: \"What are the latest developments in quantum computing?\"\n * });\n * console.log(results);\n * ```\n */\nexport class TavilyResearch extends StructuredTool<typeof inputSchema> {\n  static lc_name(): string {\n    return \"TavilyResearch\";\n  }\n\n  override description: string =\n    \"Performs comprehensive research on a given topic using the Tavily Research API. \" +\n    \"This tool uses an intelligent research agent that can answer complex questions, \" +\n    \"gather in-depth information from multiple sources, and provide structured outputs. \" +\n    \"Useful for when you need to answer complex questions or gather comprehensive \" +\n    \"information about a subject. Input should be a research task or question.\";\n\n  override name: string = \"tavily_research\";\n\n  override schema = inputSchema;\n\n  apiBaseUrl?: string;\n\n  model?: ResearchModel;\n\n  outputSchema?: Record<string, unknown>;\n\n  enableStream?: boolean;\n\n  citationFormat?: CitationFormat;\n\n  private apiWrapper: TavilyResearchAPIWrapper;\n\n  constructor(params: TavilyResearchAPIRetrieverFields = {}) {\n    super(params);\n\n    if (typeof params.name === \"string\") {\n      this.name = params.name;\n    }\n\n    if (typeof params.description === \"string\") {\n      this.description = params.description;\n    }\n\n    if (params.apiWrapper) {\n      this.apiWrapper = params.apiWrapper;\n    } else {\n      const apiWrapperParams: { tavilyApiKey?: string; apiBaseUrl?: string } =\n        {};\n      if (params.tavilyApiKey) {\n        apiWrapperParams.tavilyApiKey = params.tavilyApiKey;\n      }\n      if (params.apiBaseUrl) {\n        apiWrapperParams.apiBaseUrl = params.apiBaseUrl;\n      }\n      this.apiWrapper = new TavilyResearchAPIWrapper(apiWrapperParams);\n    }\n\n    this.model = params.model;\n    this.outputSchema = params.outputSchema;\n    this.enableStream = params.stream;\n    this.citationFormat = params.citationFormat;\n  }\n\n  async _call(\n    input: InferInteropZodOutput<typeof inputSchema>,\n    _runManager?: CallbackManagerForToolRun\n  ): Promise<\n    | TavilyResearchQueueResponse\n    | AsyncGenerator<Buffer, void, unknown>\n    | { error: string }\n  > {\n    try {\n      const {\n        input: inputValue,\n        model,\n        outputSchema,\n        stream,\n        citationFormat,\n      } = input;\n\n      const effectiveModel = this.model ?? model ?? \"auto\";\n      const effectiveOutputSchema = this.outputSchema ?? outputSchema;\n      const effectiveStream = this.enableStream ?? stream ?? false;\n      const effectiveCitationFormat =\n        this.citationFormat ?? citationFormat ?? \"numbered\";\n\n      const result = await this.apiWrapper.rawResults({\n        input: inputValue,\n        model: effectiveModel,\n        outputSchema: effectiveOutputSchema,\n        stream: effectiveStream,\n        citationFormat: effectiveCitationFormat,\n      });\n\n      if (effectiveStream) {\n        return result as AsyncGenerator<Buffer, void, unknown>;\n      }\n\n      const queueResponse = result as TavilyResearchQueueResponse;\n      if (\n        !queueResponse ||\n        typeof queueResponse !== \"object\" ||\n        !(\"request_id\" in queueResponse)\n      ) {\n        const errorMessage =\n          `Invalid research queue response for '${inputValue}'. ` +\n          `Please try rephrasing your research question or adjusting the model.`;\n\n        throw new Error(errorMessage);\n      }\n\n      return queueResponse;\n    } catch (e: unknown) {\n      const errorMessage =\n        e && typeof e === \"object\" && \"message\" in e ? e.message : String(e);\n      return { error: errorMessage as string };\n    }\n  }\n}\n"],"mappings":";;;;;AAmHA,MAAMA,6BAA2C,EAAE,KAAK,MACtD,EAAE,OAAO;CACP,MAAM,EAAE,KAAK;EAAC;EAAU;EAAU;EAAW;EAAU;CAAQ,EAAC,CAAC,UAAU;CAC3E,aAAa,EAAE,QAAQ,CAAC,UAAU;CAClC,YAAY,EACT,OAEC,2BACD,CACA,UAAU;CACb,OAAO,EACJ,OAAO,EACN,MAAM,EAAE,KAAK;EAAC;EAAU;EAAU;EAAW;EAAU;CAAQ,EAAC,CACjE,EAAC,CACD,UAAU;AACd,EAAC,CACH;AAED,MAAM,cAAc,EAAE,OAAO;CAC3B,OAAO,EAAE,QAAQ,CAAC,SAAS,gDAAgD;CAC3E,OAAO,EACJ,KAAK;EAAC;EAAQ;EAAO;CAAO,EAAC,CAC7B,UAAU,CACV,SACC,CAAC;;;;;MAKD,CAAC,CACF;CACH,cAAc,EACX,OAAO;EACN,YAAY,EAAE,OAAO,2BAA2B;EAChD,UAAU,EAAE,MAAM,EAAE,QAAQ,CAAC,CAAC,UAAU;CACzC,EAAC,CACD,UAAU,CACV,SACC,CAAC;;;;MAID,CAAC,CACF;CACH,QAAQ,EACL,SAAS,CACT,UAAU,CACV,SACC,CAAC;;;MAGD,CAAC,CACF;CACH,gBAAgB,EACb,KAAK;EAAC;EAAY;EAAO;EAAO;CAAU,EAAC,CAC3C,UAAU,CACV,SACC,CAAC;4BACqB,CAAC,CACxB;AACJ,EAAC;;;;;;;;;;;;;;;;;;;;;;AAsBF,IAAa,iBAAb,cAAoC,eAAmC;CACrE,OAAO,UAAkB;AACvB,SAAO;CACR;CAED,AAAS,cACP;CAMF,AAAS,OAAe;CAExB,AAAS,SAAS;CAElB;CAEA;CAEA;CAEA;CAEA;CAEA,AAAQ;CAER,YAAYC,SAA2C,CAAE,GAAE;EACzD,MAAM,OAAO;AAEb,MAAI,OAAO,OAAO,SAAS,UACzB,KAAK,OAAO,OAAO;AAGrB,MAAI,OAAO,OAAO,gBAAgB,UAChC,KAAK,cAAc,OAAO;AAG5B,MAAI,OAAO,YACT,KAAK,aAAa,OAAO;OACpB;GACL,MAAMC,mBACJ,CAAE;AACJ,OAAI,OAAO,cACT,iBAAiB,eAAe,OAAO;AAEzC,OAAI,OAAO,YACT,iBAAiB,aAAa,OAAO;GAEvC,KAAK,aAAa,IAAI,yBAAyB;EAChD;EAED,KAAK,QAAQ,OAAO;EACpB,KAAK,eAAe,OAAO;EAC3B,KAAK,eAAe,OAAO;EAC3B,KAAK,iBAAiB,OAAO;CAC9B;CAED,MAAM,MACJC,OACAC,aAKA;AACA,MAAI;GACF,MAAM,EACJ,OAAO,YACP,OACA,cACA,QACA,gBACD,GAAG;GAEJ,MAAM,iBAAiB,KAAK,SAAS,SAAS;GAC9C,MAAM,wBAAwB,KAAK,gBAAgB;GACnD,MAAM,kBAAkB,KAAK,gBAAgB,UAAU;GACvD,MAAM,0BACJ,KAAK,kBAAkB,kBAAkB;GAE3C,MAAM,SAAS,MAAM,KAAK,WAAW,WAAW;IAC9C,OAAO;IACP,OAAO;IACP,cAAc;IACd,QAAQ;IACR,gBAAgB;GACjB,EAAC;AAEF,OAAI,gBACF,QAAO;GAGT,MAAM,gBAAgB;AACtB,OACE,CAAC,iBACD,OAAO,kBAAkB,YACzB,EAAE,gBAAgB,gBAClB;IACA,MAAM,eACJ,CAAC,qCAAqC,EAAE,WAAW,uEAAG,CACgB;AAExE,UAAM,IAAI,MAAM;GACjB;AAED,UAAO;EACR,SAAQC,GAAY;GACnB,MAAM,eACJ,KAAK,OAAO,MAAM,YAAY,aAAa,IAAI,EAAE,UAAU,OAAO,EAAE;AACtE,UAAO,EAAE,OAAO,aAAwB;EACzC;CACF;AACF"}